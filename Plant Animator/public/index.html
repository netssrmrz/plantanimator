<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Plant Animator</title>
  <style>
    html, body
    {
      margin: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background-color: #fff;
    }

    #canvas
    {
      xborder: 1px solid #f00;
      width: 100%;
      height: 100%;
    }
  </style>
  <script type="module">
    import { Plant_Stem as Plant, Random } from "./lib/pa.js";

    window.onload = Main;
    function Main()
    {
      var c, plant, plants, canvas, canvas_ctx;

      canvas = document.getElementById("canvas");
      canvas_ctx = canvas.getContext("2d");
      canvas_ctx.strokeStyle = "#aaa";
      canvas_ctx.fillStyle = "#fff";
      canvas_ctx.lineWidth = 4;
      canvas_ctx.lineCap = 'round';

      plants = [];
      plants.push(New_Top_Border(canvas_ctx));
      plants.push(New_Left_Border(canvas_ctx));
      plants.push(New_Bottom_Border(canvas_ctx));
      plants.push(New_Right_Border(canvas_ctx));

      Animate.canvas_ctx = canvas_ctx;
      Animate.plants = plants;
      Animate();
    }

    function New_Top_Border(canvas_ctx)
    {
      var plant = new Plant();
      plant.maturity_rate = 0.25;
      plant.level = 3;
      plant.canvas_ctx = canvas_ctx;
      plant.x = 0;
      plant.y = 0;
      plant.x_scale = 1;
      plant.y_scale = -1;
      plant.angle = 0.14;
      return plant;
    }

    function New_Bottom_Border(canvas_ctx)
    {
      var plant = new Plant();
      plant.maturity_rate = 0.25;
      plant.level = 3;
      plant.canvas_ctx = canvas_ctx;
      plant.x = 2000;
      plant.y = 1000;
      plant.x_scale = -1;
      plant.y_scale = 1;
      plant.angle = 0.14;
      return plant;
    }

    function New_Left_Border(canvas_ctx)
    {
      var plant = new Plant();
      plant.maturity_rate = 0.25;
      plant.level = 4;
      plant.canvas_ctx = canvas_ctx;
      plant.x = 0;
      plant.y = 0;
      plant.x_scale = -1;
      plant.y_scale = -1;
      plant.angle = -1.7;
      return plant;
    }

    function New_Right_Border(canvas_ctx)
    {
      var plant = new Plant();
      plant.maturity_rate = 0.25;
      plant.level = 4;
      plant.canvas_ctx = canvas_ctx;
      plant.x = 2000;
      plant.y = 1000;
      plant.x_scale = 1;
      plant.y_scale = 1;
      plant.angle = -1.7;
      return plant;
    }

    function Animate()
    {
      var c, next_frame = false, next_plant_frame;

      Animate.canvas_ctx.clearRect(0, 0, Animate.canvas_ctx.canvas.width, Animate.canvas_ctx.canvas.height);
      for (c = 0; c < Animate.plants.length; c++)
      {
        next_plant_frame = Animate.plants[c].Next_Frame();
        next_frame = next_frame || next_plant_frame;
      }
      if (next_frame)
        window.requestAnimationFrame(Animate);
      /*else
      {
        Animate.plants.push(New_Top_Border(Animate.canvas_ctx));
        Animate.plants.push(New_Left_Border(Animate.canvas_ctx));
        window.requestAnimationFrame(Animate);
      }*/
    };
  </script>
  <script>
  </script>
</head>

  <body>
    <canvas id="canvas" width="2000" height="1000"></canvas>
    <div id="log"></div>
  </body>

  </html>