<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Plantimator - Plant Editor</title>
    <style>
      @font-face
      {
        font-family: parisienne;
        src: url(fonts/Parisienne-Regular.ttf);
      }
      @font-face
      {
        font-family: clickerscript;
        src: url(fonts/ClickerScript-Regular.ttf);
      }
      @font-face
      {
        font-family: dancingscript;
        src: url(fonts/DancingScript-VariableFont_wght.ttf);
      }
      .hp
      {
        font-weight: 100;
        position: relative;
        top: -6px;
      }
      h1
      {
        margin: 10px;
      }
      .h1a
      {
        font-family: parisienne;
        color: deeppink;
        font-size: 54px;
        font-weight: 100;
      }
      .h1b
      {
        color: #000;
        font-family: parisienne;
        font-size: 54px;
        font-weight: 100;
      }
      .h1c
      {
        color: deeppink;
        font-family: parisienne;
        font-size: 54px;
        font-weight: 100;
      }
      .h1d
      {
        color: #000;
        font-family: serif;
        font-size: 42px;
        font-weight: 100;
      }
      body
      {
        text-align: center;
        margin: 0px;
        background-color: #fffff9;
      }
      button
      {
        border-radius: 7px;
        border: 1px solid #000;
        padding: 5px;
        cursor: pointer;
        width: 36px;
        height: 36px;
        background-color: inherit;
      }
      button img
      {
        padding: 0;
        margin: 0;
        width: 24px;
        height: 24px;
      }
      button:disabled
      {
        opacity: 0.25;
      }
    </style>
    <script type="module">
      import * as pl from "./lib/pa.js";
      import "./lib/Sprout_Editor.js";
      import "./lib/Sprout_List.js";

      window.onload = Main;
      let sprout_list, editor;

      function Main()
      {
        document.getElementById("new_plant_btn").onclick=OnClick_New_Plant;
        document.getElementById("play_btn").onclick = OnClick_Play;
        document.getElementById("design_btn").onclick = OnClick_Design;
        
        sprout_list = document.getElementById("sprout_list");
        sprout_list.on_change_fn = Plants_OnChange;
        
        editor = document.getElementById("sprout_editor");
        editor.plants = sprout_list.plants;
        editor.on_change_fn = Editor_OnChange;
        editor.Render_Plants();
                
        sprout_list.this_class = editor.this_class;
      }

      function Plants_OnChange()
      {
        editor.Design_Mode();
        editor.Render_Plants();
      }

      function Editor_OnChange(plant)
      {
        sprout_list.requestUpdate();
      }

      // button bar ===============================================================================

      function OnClick_New_Plant()
      {
        const plant = New_Item();
        sprout_list.Add_Plant(plant);
        editor.Design_Mode();
        editor.Render_Plants();
      }
    
      function OnClick_Play()
      {
        if (editor.is_playing)
        {
          editor.Stop();
          OnStop_Play();
        }
        else
        {
          editor.Play(OnStop_Play);
          document.getElementById("new_plant_btn").disabled = true;
          document.getElementById("design_btn").disabled = true;
          sprout_list.Set_Disabled(true);
        }
      }

      function OnStop_Play()
      {
        document.getElementById("new_plant_btn").disabled = false;
        document.getElementById("design_btn").disabled = false;
        sprout_list.Set_Disabled(false);
      }

      function OnClick_Design()
      {
        editor.Design_Mode();
      }

      function New_Item()
      {
        const class_name = "Plant_Leaf";

        const item = new pl[class_name];
        item.class_name = class_name;
        item.name = "Sprout 1";
        item.maturity_rate = 1;
        item.maturity = 0;
        item.max_depth = 3;
        item.x = 0;
        item.y = 250;
        item.x_scale = 1;
        item.y_scale = 1;
        item.angle = 0;
        item.sprout_time = 50;

        return item;
      }
    </script>
  </head>

  <body>
    <h1>
      <span class="hp">&#x1f337;</span>
      <span class="h1a">Pl</span><span class="h1b">an</span><span class="h1c">t</span><span class="h1d">imator</span>
    </h1>

    <sprout-editor id="sprout_editor"></sprout-editor>

    <div>
      <button id="new_plant_btn"><img src="images/plus.svg"></button>
      <button id="play_btn"><img src="images/play-pause.svg"></button>
      <button id="design_btn"><img src="images/pencil-ruler.svg"></button>
    </div>

    <sprout-list id="sprout_list"></sprout-list>

  </body>
</html>