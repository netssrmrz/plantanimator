<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Plant Animator - Home</title>
    <style>
      canvas
      {
        border: 4px solid #eee;
        margin-right: 3px;
        padding: 3px;
      }

      #plant_props_div
      {
        display: none;
      }

      #palette_div
      {
        display: none;
      }
    </style>
    <script type="module">
      import * as pl from "./lib/pa.js";

      const plants = [];
      window.onload = Main;

      function Main()
      {
        var c, plant, plants, canvas, canvas_ctx;

        document.getElementById("new_plant_btn").onclick=OnClick_New_Plant;

        New_Plant("Plant_Flower").Render_All();
        New_Plant("Plant_Flower2").Render_All();
        New_Plant("Plant_Flower3").Render_All();
        New_Plant("Plant_Flower4").Render_All();
        New_Plant("Plant_Flower5").Render_All();
        New_Plant("Plant_Flower6").Render_All();
        New_Plant("Plant_Flower7").Render_All();
        New_Plant("Plant_Flower8").Render_All();
        New_Plant("Plant_Flower9").Render_All();
        New_Plant("Plant_Flower10").Render_All();
        New_Plant("Plant_Flower11").Render_All();
        New_Plant("Plant_Flower12").Render_All();
        New_Plant("Plant_Leaf").Render_All();
        New_Plant("Plant_Leaf2").Render_All();
        New_Plant("Plant_Leaf3").Render_All();
        New_Plant("Plant_Leaf4").Render_All();
        New_Plant("Plant_Leaf5").Render_All();
        New_Plant("Plant_Leaf6").Render_All();
        New_Plant("Plant_Leaf7").Render_All();
        New_Plant("Plant_Leaf8").Render_All();
        New_Plant("Plant_Leaf9").Render_All();
      }

      function Init_Canvas(class_name)
      {
        const canvas = document.createElement("canvas");
        canvas.id = class_name + "_canvas";
        canvas.width = "200";
        canvas.height = "200";
        document.getElementById("palette_div").appendChild(canvas);

        const canvas_ctx = canvas.getContext("2d");

        canvas_ctx.font = "12px sans-serif";
        canvas_ctx.strokeText(class_name, 10, 20);

        canvas_ctx.strokeStyle = "#aaa";
        canvas_ctx.fillStyle = "#fff";
        canvas_ctx.lineWidth = 4;
        canvas_ctx.lineCap = 'round';
        canvas_ctx.lineJoin = 'round';

        return canvas_ctx;
      }

      function New_Plant(class_name)
      {
        var plant = new pl[class_name];
        plant.maturity_rate = 1;
        plant.maturity = 100;
        plant.level = 1;
        plant.canvas_ctx = Init_Canvas(class_name);
        plant.x = 100;
        plant.y = 100;
        plant.x_scale = 1;
        plant.y_scale = -1;
        plant.angle = 0;
        return plant;
      }

      // button bar ===============================================================================

      function OnClick_New_Plant()
      {
        const dlg = document.getElementById("plant_props_dlg")
        dlg.plant_class = "Plant";
        dlg.plant_x_pos = 0;
        dlg.plant_y_pos = 0;
        dlg.plant_x_scale = 1;
        dlg.plant_y_scale = 1;
        dlg.plant_angle = 0;
        dlg.onclick_ok = OnClick_New_Plant_Ok;
        dlg.Show();
      }

      function OnClick_New_Plant_Ok(plant)
      {
        plants.push(plant);
        // render list
      }
    </script>

    <script type="module">
      import {LitElement, html, css} from "./lib/lit-element/lit-element.js";
      import * as pl from "./lib/pa.js";

      class Plant_Props_Dialog extends LitElement 
      {
        OnClick_Ok()
        {
          var plant = new pl[this.plant_class];
          plant.maturity_rate = 1;
          plant.maturity = 100;
          plant.level = 1;
          //plant.canvas_ctx = Init_Canvas(class_name);
          plant.x = this.plant_x_pos;
          plant.y = this.plant_y_pos;
          plant.x_scale = this.plant_x_scale;
          plant.y_scale = this.plant_y_scale;
          plant.angle = this.plant_angle;
          this.Hide();
          this.onclick_ok(plant);
        }

        OnClick_Cancel()
        {
          this.Hide();
        }

        Hide()
        {
          this.style.display = "none";
        }

        Show()
        {
          this.style.display = "block";
        }

        static get properties()
        {
          return { 
            plant_class: { type: String },
            plant_x_pos: { type: Number },
            plant_y_pos: { type: Number },
            plant_x_scale: { type: Number },
            plant_y_scale: { type: Number },
            plant_angle: { type: Number }
          };
        }

        static get styles()
        {
          return css`
            :host
            {
              display: none;
            }
            `;
        }

        render() 
        {
          return html`
            <div>
              <div>Class</div>
              <div><input id="plant_class" type="text" value="${this.plant_class}"></div>
            </div>
            <div>
              <div>X Position</div>
              <div><input id="plant_x_pos" type="number" value="${this.plant_x_pos}"></div>
            </div>
            <div>
              <div>Y Position</div>
              <div><input id="plant_y_pos" type="number" value="${this.plant_y_pos}"></div>
            </div>
            <div>
              <div>X Scale</div>
              <div><input id="plant_x_scale" type="number" value="${this.plant_x_scale}"></div>
            </div>
            <div>
              <div>Y Scale</div>
              <div><input id="plant_y_scale" type="number" value="${this.plant_y_scale}"></div>
            </div>
            <div>
              <div>Angle</div>
              <div><input id="plant_angle" type="number" value="${this.plant_angle}"></div>
            </div>
            <div>
              <button id="new_plant_ok_btn" @click="${this.OnClick_Ok}">Ok</button>
              <button id="new_plant_cancel_btn" @click="${this.OnClick_Cancel}">Cancel</button>
            </div>
            `;
        }
      }
  
      customElements.define('plant-props-dlg', Plant_Props_Dialog);
    </script>
  </head>

  <body>

    <canvas id="main_canvas" width="1000" height="1000"></canvas>

    <div id="">
      <button id="new_plant_btn">New</button>
      <button>Edit</button>
      <button>Delete</button>
      <ul></ul>
    </div>

    <plant-props-dlg id="plant_props_dlg"></plant-props-dlg>

    <div id="palette_div">
    </div>

  </body>
</html>